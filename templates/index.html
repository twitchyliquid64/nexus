<html>
<head>
    <title>Nexus</title>

    <!-- Materialize CSS -->
    <link rel="stylesheet" href="/static/css/material-icons.css">
    <link rel="stylesheet" href="/static/css/materialize.min.css">
    <link rel="stylesheet" href="/static/css/animations.css">
    <link rel="stylesheet" href="/static/css/general.css">

    <style type="text/css">
    /**
     * Hide when Angular is not yet loaded and initialized
     */
    [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak {
      display: none !important;
    }
    .nav-wrapper {
      margin-right: 2px;
    }
    </style>

    <!-- JavaScript for: jQuery, angular, materialize, and angular-materialize. All of which are needed. -->
    <script type="text/javascript" src="/static/js/libs/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="/static/js/libs/angular.min.js"></script>
    <script type="text/javascript" src="/static/js/libs/materialize.min.js"></script>
    <script type="text/javascript" src="/static/js/libs/moment.min.js"></script>
    <script type="text/javascript" src="/static/js/libs/angular-moment.min.js"></script>
    <script type="text/javascript" src="/static/js/libs/angular-materialize.min.js"></script>


    <script type="text/javascript" src="/static/js/app.js"></script>
    <script type="text/javascript" src="/static/js/accounts/accounts.js"></script>
    <script type="text/javascript" src="/static/js/accounts/accountEditModal.js"></script>
    <script type="text/javascript" src="/static/js/data/controller.js"></script>
    <script type="text/javascript" src="/static/js/data/editModal.js"></script>
    <script type="text/javascript" src="/static/js/data/exploreController.js"></script>
    <script type="text/javascript" src="/static/js/data/filterDirective.js"></script>
</head>
<body ng-app="nexus" ng-controller="BodyController" ng-cloak>
  <nav class="light-blue lighten-2" role="navigation">
    <div class="nav-wrapper">
      <a id="logo-container" href="#" class="brand-logo"><i class="material-icons">language</i> Nexus</a>
      <ul class="right hide-on-med-and-down">
        <li ng-class="{active: page == 'home'}"><a href="#" ng-click="changePage('home')"><i class="material-icons left">home</i> Home</a></li>
        <li ng-class="{active: page == 'accounts'}"><a href="#" ng-click="changePage('accounts')"><i class="material-icons left">supervisor_account</i> Accounts</a></li>
        <li ng-class="{active: page == 'data' || page == 'data-explorer'}"><a href="#" ng-click="changePage('data')"><i class="material-icons left">storage</i> Datastores</a></li>
        <li ng-class="{active: page == 'integration'}"><a href="#" ng-click="changePage('integration')"><i class="material-icons left">import_export</i> Integrations</a></li>
      </ul>
      <a href="#" data-activates="nav-mobile"  data-sidenav="left" data-menuwidth="500" data-closeonclick="true" class="button-collapse"><i class="material-icons">menu</i></a>
    </div>
  </nav>

  <ul id="nav-mobile" class="side-nav">
    <li><a href="#" ng-click="changePage('home')">Home</a></li>
  </ul>

  <div ng-show="page == 'accounts'" class="container">
    <h3>Accounts</h3>
    <div ng-controller="AccountViewController">
      <loader loading="loading" error="error"></loader>

      <table class="highlight">
        <thead>
          <tr>
              <th>UID</th>
              <th>Username</th>
              <th>Display Name</th>
              <th>Created</th>
              <th>Admin Permissions</th>
              <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr ng-repeat="user in accounts">
            <td ng-click="edit(user)" style="cursor: pointer;">{{user.UID}}</td>
            <td ng-click="edit(user)" style="cursor: pointer;">{{user.Username}}<i class="material-icons right" ng-if="user.IsRobot">developer_board</i></td>
            <td ng-click="edit(user)" style="cursor: pointer;">{{user.DisplayName}}</td>
            <td am-time-ago="user.CreatedAt"></td>
            <td>
              <i class="material-icons left" ng-if="user.AdminPerms.Accounts">supervisor_account</i>
              <i class="material-icons left" ng-if="user.AdminPerms.Data">storage</i>
              <i class="material-icons left" ng-if="user.AdminPerms.Integrations">import_export</i>
            </td>
            <td>
              <a class="btn-floating" href="#" ng-click="delete(user.UID)"><i class="material-icons">delete</i></a>
              <a class="btn-floating" href="#" ng-click="changeAuth(user)"><i class="material-icons">vpn_key</i></a>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="fixed-action-btn">
        <a href="#" class="btn-floating btn-large red tooltipped" data-position="left" data-delay="50" data-tooltip="Create Account" ng-click="createAccount()">
          <i class="large material-icons">person_add</i>
        </a>
      </div>
    </div>

    <account-edit-modal></account-edit-modal>
  </div>

  <div ng-show="page == 'data'" class="container">
    <h3>Datastores</h3>
    <div ng-controller="DatastoreController">
      <loader loading="loading" error="error"></loader>

      <table class="highlight">
        <thead>
          <tr>
              <th>UID</th>
              <th>Name</th>
              <th>Created</th>
              <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr ng-repeat="ds in datastores">
            <td ng-click="edit(ds)" style="cursor: pointer;">{{ds.UID}}</td>
            <td ng-click="edit(ds)" style="cursor: pointer;">{{ds.Name}}</td>
            <td am-time-ago="ds.CreatedAt"></td>
            <td>
              <a class="btn-floating" href="#" ng-click="delete(ds.UID)"><i class="material-icons">delete</i></a>
              <a class="btn-floating" href="#" ng-click="explore(ds)"><i class="material-icons">search</i></a>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="fixed-action-btn">
        <a href="#" class="btn-floating btn-large red tooltipped" data-position="left" data-delay="50" data-tooltip="Create Datastore" ng-click="create()">
          <i class="large material-icons">add</i>
        </a>
      </div>
    </div>

    <datastore-edit-modal></datastore-edit-modal>
  </div>

  <div ng-show="page == 'data-explorer'" style="margin: 0px 9px;">
    <div ng-controller="DataExplorerController" class="container">
      <h3>{{datastore.Name}}</h3>
      <loader loading="loading" error="error"></loader>
      <datastore-filter ds="datastore" on-change="filtersChanged(filters)"></datastore-filter>

      <table class="highlight section">
        <thead>
          <tr>
              <th>UID</th>
              <th ng-repeat="col in datastore.Cols">{{col.Name}}</th>
          </tr>
        </thead>

        <tbody>
          <tr ng-repeat="row in data">
            <td ng-repeat="col in row">{{col}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <confirmation-dialog-modal></confirmation-dialog-modal>
</body>
